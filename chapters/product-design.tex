\chapter{Struttura principale e progettazione}\label{cap:struttura-progettazione}

\intro{In questo capitolo saranno descritte la struttura principale del progetto e le attività di progettazione dell'applicativo.
Inoltre verranno descritte le tecnologie utilizzate durante lo sviluppo del progetto e le scelte architetturali.
}

\section{Tecnologie utilizzate}\label{sec:tecnologie-utilizzate}
Di seguito viene data una panoramica delle tecnologie utilizzate durante lo sviluppo del progetto di stage.

\subsection{Frontend}\label{subsec:frontend}
\subsubsection{Vue.js}\label{subsubsec:vue}
\textit{Vue.js} è un \textit{framework JavaScript} progressivo e reattivo, utilizzato per lo sviluppo di interfacce utente dinamiche e moderne. 
Creato da \textit{Evan You}, \textit{Vue.js} è apprezzato per la sua semplicità d'uso e flessibilità. Con un sistema di reattività basato su un modello di oggetti e dipendenze, 
\textit{Vue.js} rende facile il monitoraggio e l'aggiornamento automatico dell'interfaccia utente in base ai cambiamenti di stato dei dati. La sua architettura basata 
su componenti consente di organizzare il codice in moduli riutilizzabili e autonomi, semplificando la creazione di applicazioni complesse. 
Grazie alle direttive, è possibile arricchire il \glsfirstoccur{\gls{domg}} con funzionalità reattive, mentre il sistema di \textit{routing} agevola la creazione di \glsfirstoccur{\gls{spag}}. 
Con una crescita costante della comunità di sviluppatori, \textit{Vue.js} è diventato un'opzione popolare nel mondo dello sviluppo frontend.
Per il mio progetto sono andato ad utilizzare la versione 3 di \textit{Vue.js}, insieme allo \textit{script setup}, che è una nuova sintassi per definire componenti progettata per semplificare la struttura del codice e migliorare la leggibilità.

\subsubsection{TypeScript}\label{subsubsec:TypeScript}
\textit{TypeScript} è un linguaggio di programmazione \glsfirstoccur{\gls{opensourceg}} sviluppato da \textit{Microsoft}. Si basa su \textit{JavaScript} e offre tipizzazione statica opzionale, 
consentendo agli sviluppatori di specificare tipi per variabili, parametri di funzioni e oggetti. Questa caratteristica aiuta a individuare errori e a migliorare 
la manutenibilità del codice.\\
All'interno del mio progetto sono andato a creare per la parte frontend una cartella chiamata \textit{types} che contiene un file \textit{TypeScript} contenente tutti i tipi utilizzati all'interno del progetto.
\subsubsection{Vite.js}\label{subsubsec:vite}
\textit{Vite.js} è un \textit{build tool} utilizzato per lo sviluppo di applicazioni web. È stato creato da \textit{Evan You}, lo stesso creatore di \textit{Vue.js}, e si basa su \glsfirstoccur{\gls{rollupjsg}}.
\textit{Vite.js} è stato progettato per essere veloce, semplice da utilizzare e facile da configurare. La sua velocità è dovuta al fatto che utilizza la tecnica dell'\glsfirstoccur{\gls{esmg}} (\textit{ECMAScript Modules})
che permette di caricare i moduli in modo asincrono, riducendo i tempi di compilazione e di \glsfirstoccur{\gls{hotreloadg}}.
\subsubsection{Sass}\label{subsubsec:Sass}
\textit{Sass} è un'estensione di \textit{CSS} che offre funzionalità aggiuntive e avanzate per semplificare e organizzare il modo in cui viene scritto e gestito il codice.
Può essere considerato un preprocessore \textit{CSS}, in quanto viene compilato in \textit{CSS} prima di essere interpretato dal \textit{browser}. \textit{Sass} inoltre permette di utilizzare funzionalità non disponibili in \textit{CSS} nativo, offrendo una serie di funzioni, variabili, \textit{mixin} e altro.\\
Insieme a \textit{Sass}, ho utilizzato \textit{BEM}, ovvero una metodologia di \textit{naming convention} utilizzata nel mondo dello sviluppo web.

\subsection{Backend}\label{subsec:backend}
\subsubsection{Nest.js}\label{subsubsec:nest}
\textit{Nest.js} è un \textit{framework} per applicazioni \textit{server-side} basato su \textit{Node.js}. Si basa su \glsfirstoccur{\gls{expressjsg}} e \textit{TypeScript} ed è progettato per creare applicazioni scalabili e performanti.
Il \textit{framework} in questione combina concetti e caratteristiche provenienti da diversi paradigmi di sviluppo, tra cui la programmazione orientata agli oggetti (OOP), la programmazione funzionale e la programmazione reattiva.

\subsection{Altre tecnologie di supporto}\label{subsec:altre-tecnologie-di-supporto}
\subsubsection{Node.js}\label{subsubsec:node.js}
\textit{Node.js} è un ambiente di \textit{runtime JavaScript open-source} progettato per eseguire codice lato server. Per gestire le dipendenze del mio progetto,
ho deciso di utilizzare \glsfirstoccur{\gls{pnpmg}} come gestore di pacchetti. Questa selezione ha portato a un miglior utilizzo delle risorse di sistema e ha notevolmente accelerato il processo di 
installazione delle dipendenze.
 \subsubsection{Pinia}\label{subsubsec:pinia}
 \textit{Pinia} è una libreria per la gestione dello stato per applicazioni \textit{Vue.js}. Promuove l'uso di \textit{store} modulari, ognuno dei quali gestisce uno stato specifico dell'applicazione.
\subsubsection{Vue-router}\label{subsubsec:vue-router}
\textit{Vue-router} è una libreria per la gestione delle \textit{route} per le applicazioni \textit{Vue.js}. Permette di definire le \textit{route} dell'applicazione e di navigare tra le pagine.

\subsection{Versionamento}\label{subsec:versionamento}
\subsubsection{Git}\label{subsubsec:git}
\textit{Git} è un sistema di controllo versione distribuito e altamente flessibile, utile per tenere traccia delle modifiche apportate al codice sorgente durante lo sviluppo di un progetto \glsfirstoccur{\gls{softwareg}}.
\subsubsection{CodeCommit}\label{subsubsec:CodeCommit}
\textit{AWS CodeCommit} rappresenta un servizio di \textit{hosting} di \textit{repository} altamente scalabile, che è gestito all'interno dell'ecosistema di \glsfirstoccur{\gls{awsg}} (\textit{Amazon Web Services}). 
Con \textit{CodeCommit}, è possibile ospitare \textit{repository Git} privati in un ambiente sicuro e flessibile.

\subsection{Verifica}\label{subsec:verifica}
\subsubsection{ESLint}\label{subsubsec:eslint}
\textit{ESLint} è uno strumento \textit{open-source} ampiamente utilizzato per l'analisi statica del codice \textit{JavaScript}. Esso permette di identificare e segnalare potenziali errori o pratiche non conformi durante la fase di sviluppo.
\subsubsection{Vitest}\label{subsubsec:vitest}
\textit{Vitest} è un \textit{framework} per l'implementazione di test di unità, utilizzato prevalentemente in progetti \textit{Vue.js}.
Usato in coppia con \textit{Vite} permette di eseguire test di unità in modo più veloce e semplice.

\subsection{Librerie esterne utilizzate}\label{subsec:librerie-esterne}
\subsubsection{THRON Components}\label{subsubsec:thron-components}
La libreria \textit{THRON Components} contiene i componenti utilizzati per creare elementi comuni, come i bottoni del portale, seguendo il design aziendale.
\subsubsection{Azure MSAL}\label{subsubsec:azure-MSAL}
\textit{Azure MSAL} è una libreria che permette di integrare il login con \glsfirstoccur{\gls{azureadg}} (\textit{Azure Active Directory}) all'interno di un'applicazione web.
\subsubsection{Swagger UI}\label{subsubsec:swagger-ui}
\textit{Swagger UI} è una libreria \textit{open-source} progettata per semplificare la visualizzazione e l'interazione con la documentazione delle \textit{API}.

\section{Struttura principale del sistema}
Il sistema è composto da due principali sezioni:
\begin{itemize}
  \item Frontend, ovvero l'interfaccia utente dell'applicazione web che permette all'utilizzatore di interagire con il sistema. È responsabile di presentare i contenuti in modo visivamente attraente e interattivo, consentendo agli utenti di navigare, inserire dati e svolgere azioni specifiche. Per lo
  sviluppo di questa parte del sistema è stato utilizzato il \textit{framework Vue.js};
  \item Backend, ovvero la parte del sistema che elabora le richieste provenienti dal frontend e restituisce i risultati. È responsabile della gestione dei dati e della logica di \textit{business}.
  Lo sviluppo di questa parte del sistema è stato realizzato utilizzando il \textit{framework Nest.js}. 
\end{itemize}

\subsection{Ambienti di sviluppo}
Gli ambienti di \textit{staging} sono ambienti di test che vengono utilizzati per testare le funzionalità dell'applicazione prima di rilasciarla in produzione.
A livello aziendale sono stati definiti tre ambienti di cui i primi due di \textit{staging}, denominati come segue:
\begin{itemize}
  \item \textbf{\textit{Development}}: consente di validare a livello tecnico le funzionalità;
  \item \textbf{\textit{Quality}}: consente di validare a livello funzionale o di implementazione le funzionalità;
  \item \textbf{\textit{Production}}: ambiente di produzione in cui viene rilasciata la funzionalità.
\end{itemize}

\subsection{Configurazione dell'ambiente per lo sviluppo del progetto}
Il progetto di stage, necessita di cartelle per la configurazione dell'ambiente di sviluppo, per la configurazione del progetto e per la configurazione del \textit{deploy}.
Più precisamente, il progetto segue la seguente struttura:

\subsubsection*{\emph{Buildspec}}
La cartella \textit{Buildspec} contiene i file di configurazione per la \textit{build} dell'applicazione su \glsfirstoccur{\gls{awscodebuildg}}.
Questo è il primo step del processo di \textit{deploy}, in quanto viene eseguita la \textit{build} sia del \textit{middleware} che del portale.
La cartella è formata a sua volta da tre file: \textit{buildspec\_development}, \textit{buildspec\_quality} e \textit{buildspec\_production}. 
Ognuno di questi file configura la \textit{build} dell'applicazione in base all'ambiente di \textit{deploy}.\\
Successivamente dopo aver effettuato tutti i comandi specificati nei file \textit{buildspec}, inizia lo step di \textit{deploy}, specificato nella cartella \textit{Infra}.
Ognuno dei file \textit{buildspec} è un file \textit{YAML}, che è formato dalle seguenti sezioni:
\begin{itemize}
  \item La sezione \textit{env} dove vengono specificate le variabili d'ambiente utilizzate nel progetto;
  \item La sezione di \textit{pre-build} dove vengono specificati i comandi da eseguire prima della \textit{build};
  \item La sezione di \textit{build} dove vengono specificati i comandi per la \textit{build} del portale e del \textit{middleware}.
\end{itemize}

\subsubsection*{\emph{Infra}}
La cartella \textit{Infra} contiene i file di configurazione per il \textit{deploy} dell'applicazione su \textit{AWS}. È scritta utilizzando il linguaggio di programmazione \glsfirstoccur{\gls{pythong}}.\\
La cartella è formata da due file: `\textit{app.py}' e `\textit{stack.py}'. Il primo file contiene la configurazione per il \textit{deploy} dell'applicazione, mentre il secondo file contiene la configurazione per il \textit{deploy} dell'infrastruttura.\\
Per quanto riguarda l'infrastruttura del progetto, sono andato ad utilizzare e a configurare due costrutti, anche chiamati \textit{CDK Constructs} o semplicemente \textit{Constructs}, che sono delle classi che rappresentano un componente dell'infrastruttura.
Il primo costrutto si chiama \textit{THRONCloudFrontDistribution} e consente di accelerare la distribuzione dei contenuti web statici e dinamici, come file \textit{HTML}, \textit{CSS}, \textit{JS} e immagini, agli utenti.
In breve questo costrutto genera il \textit{template} di \glsfirstoccur{\gls{awscloudfrontg}} ed esegue il \textit{deploy} degli \textit{asset} statici su un \glsfirstoccur{\gls{s3g}}.\\
Il secondo costrutto che sono andato ad utilizzare si chiama \textit{THRONDockerLambda} e consente di creare una funzione \glsfirstoccur{\gls{lambdag}} in cui il gestore è un'immagine \glsfirstoccur{\gls{dockerg}}.
Nel caso del mio progetto, mi è servito per creare una \textit{lambda} che una volta invocata avvia un \textit{docker} con all'interno il progetto backend.\\

\subsubsection*{\emph{Middleware}}
La cartella \textit{Middleware} contiene il progetto backend in \textit{Nest.js}. Nello specifico la cartella è formata dalle seguenti sezioni:
\begin{itemize}
  \item La cartella \textit{src} che contiene il codice sorgente dell'applicazione, dove vengono specificati i vari \textit{endpoint} che utilizzo sulla parte frontend, lo \textit{script} per la configurazione
  della \textit{lambda}, una cartella con gli \textit{helpers} e la cartella del \textit{middleware}.
  \item La cartella test che contiene i test di unità dell'applicazione;
  \item File \textit{env} che contiene le variabili d'ambiente utilizzate nel progetto;
  \item Una cartella \textit{node\_modules} che contiene le dipendenze del progetto.
\end{itemize}
\subsubsection*{\emph{Portal}}
La cartella \textit{portal} contiene il progetto frontend in \textit{Vue.js}. Nello specifico la cartella è formata dalle seguenti sezioni:
\begin{itemize}
  \item La cartella \textit{public} che contiene il file `\textit{index.html}', che è il file principale dell'applicazione;
  \item Una cartella \textit{node\_modules} che contiene le dipendenze del progetto;
  \item La cartella \textit{src} che contiene il codice sorgente dell'applicazione, dove vengono specificati i vari componenti che utilizzo, i vari \textit{store}, i vari \textit{router} e le varie \textit{utilities};
  \item File \textit{env} che contiene le variabili d'ambiente utilizzate nel progetto.
\end{itemize}

\subsubsection*{\emph{Dockerfile}}
Il file \textit{Dockerfile} è un file \textit{docker} che contiene le istruzioni per creare un'immagine che viene utilizzata per eseguire il \textit{middleware} all'interno di una \textit{lambda}.\\
Utilizzando la struttura \textit{Dockerfile}, sono andato a creare un ambiente isolato in cui il \textit{middleware} può essere configurato e utilizzato come parte della mia funzione 
\textit{lambda}. Quando la funzione viene invocata, avvia il \textit{Docker} \glsfirstoccur{\gls{containerg}} ed esegue il \textit{middleware} all'interno dell'ambiente containerizzato, 
garantendo che esso sia parte integrante dell'applicazione \glsfirstoccur{\gls{serverlessg}}.

\section{Progettazione}\label{sec:progettazione}

\subsection{Architettura frontend}\label{subsec:architettura-front-end}
\subsubsection{Architettura Vue.js}\label{subsubsec:architettura-vue.js}
\textit{Vue.js} è un \textit{framework} utilizzato nelle \textit{single page applications}, che permette di definire le pagine web in modo modulare, utilizzando componenti riutilizzabili.
I componenti costituiscono la base dell'architettura di \textit{Vue}. Essi rappresentano una parte isolata dell'interfaccia, che può contenere il proprio modello, i propri stili e la propria logica, infatti ogni componente ha il proprio
\textit{template} scritto in \textit{HTML}, il proprio \textit{script} scritto nel mio caso in \textit{TypeScript} e i propri stili scritti nel mio caso in \textit{Scss}.
Come già accennato in precedenza, i componenti sono riutilizzabili all'interno di un'applicazione e possono essere combinati tra loro per creare gerarchie di interfacce ancora più complesse.\\

L'architettura di \textit{Vue.js} è basata sul pattern architetturale \textit{MVVM} (\textit{Model-View-ViewModel}), che è una variante del pattern \glsfirstoccur{\gls{mvcg}} (\textit{Model-View-Controller}), dove:
\begin{itemize}
  \item \textbf{\textit{Model}}: rappresenta lo stato, i dati e le regole di \textit{business} dell'applicazione, che gestiscono l'accesso e la modifica di tali dati. Lo stato viene definito tramite l'uso
  di particolari variabili di tipo reattivo, che permettono di aggiornare automaticamente la \textit{View} associata in caso di modifiche;
  \item \textbf{\textit{View}}: è l'interfaccia utente, che visualizza i dati contenuti nel \textit{Model} e si occupa di reagire agli input dell'utente. La \textit{View} è definita utilizzando i template \textit{Vue.js} e viene reattivamente aggiornata in base ai cambiamenti del modello. La vista viene definita utilizzando un \textit{template}, ovvero una direttiva dell'\textit{HTML}, arricchita con alcune direttive \textit{Vue.js}. 
  Queste particolari direttive permettono di collegare elementi del \textit{DOM} a proprietà o metodi del modello, in modo che la \textit{View} possa reagire agli input dell'utente e aggiornare automaticamente lo stato dell'applicazione;
  \item \textbf{\textit{ViewModel}}: è l'intermediario tra la \textit{View} e il \textit{Model}. Il \textit{ViewModel} gestisce la logica dell'interfaccia utente e mantiene lo stato dell'applicazione sincronizzato con la \textit{View}.
  Il \textit{ViewModel} è rappresentato da un componente \textit{Vue.js}, infatti esso è un'istanza che collega il modello e la vista. All'interno di un componente è possibile definire metodi, proprietà 
  computate, metodi del ciclo di vita, gestione di eventi e molte altre funzionalità. Questo consente di definire la logica di presentazione e di manipolare i dati all'interno di un contesto definito.
\end{itemize}

In breve, l'architettura è incentrata sulla creazione e utilizzo di componenti riutilizzabili che al loro interno incorporano sia il modello che la vista. Un aspetto che rende \textit{Vue.js}
diverso da altri \textit{framework} è proprio il concetto di reattività, infatti \textit{Vue.js} è in grado di rilevare automaticamente le dipendenze tra i componenti, in modo da poter aggiornare automaticamente l'interfaccia utente.

\subsection{Architettura backend}\label{subsec:architettura-backend}
\subsubsection{Architettura Nest.js}\label{subsubsec:architettura-nest.js}
L'architettura di \textit{Nest.js} si basa su diversi principi chiave e concetti fondamentali che lo rendono un \textit{framework} efficace per la creazione di applicazioni \textit{server-side}.
La caratteristica principale di \textit{Nest.js} è la modularità, che promuove la suddivisione dell'applicazione in moduli, consentendo di organizzare il codice in unità funzionali e riutilizzabili.\\
Di seguito i concetti base su cui si basa l'architettura:
\begin{itemize}
  \item \textbf{\textit{Module}}: rappresenta un'unità organizzativa dell'applicazione che contiene un gruppo di elementi correlati come \textit{Controller}, \textit{Service} e \textit{Provider}. Questa struttura modulare 
  favorisce la separazione delle responsabilità rendendo il codice più leggibile;
  \item \textbf{\textit{Controller}}: sono interfacce tra la rete e la logica dell'applicazione responsabili della gestione delle richieste \glsfirstoccur{\gls{httpg}} in ingresso. Ogni \textit{Controller} è associato a un percorso specifico e a uno o più metodi che rappresentano le diverse azioni eseguibili sul percorso;
  \item \textbf{\textit{Service}}: contiene la logica di \textit{business} dell'applicazione. I \textit{Service} si occupano della gestione dei dati e dell'interazione con le risorse esterne.
\end{itemize}